<!DOCTYPE html>
  <html lang="pl">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>Ankieta - Pobierz dostęp</title>
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
      <style>
          * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
          }

          body {
              font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
              background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 50%, #f5d0fe 100%);
              min-height: 100vh;
              display: flex;
              align-items: center;
              justify-content: center;
              padding: 15px;
          }

          .container {
              background: white;
              border-radius: 20px;
              padding: 35px 40px;
              max-width: 620px;
              width: 100%;
              box-shadow:
                  0 4px 6px rgba(0, 0, 0, 0.02),
                  0 12px 24px rgba(0, 0, 0, 0.06),
                  0 0 0 1px rgba(0, 0, 0, 0.03);
              text-align: center;
          }

          /* Ikona kwiat + serce */
          .icon-wrapper {
              width: 80px;
              height: 80px;
              margin: 0 auto 20px;
              position: relative;
          }

          .flower-icon {
              width: 100%;
              height: 100%;
          }

          h1 {
              color: #1f2937;
              margin-bottom: 8px;
              font-size: 26px;
              font-weight: 700;
          }

          .description {
              color: #6b7280;
              margin-bottom: 25px;
              line-height: 1.6;
              font-size: 15px;
          }

          .btn {
              background: linear-gradient(135deg, #ec4899 0%, #d946ef 100%);
              color: white;
              border: none;
              padding: 14px 32px;
              font-size: 15px;
              font-weight: 600;
              border-radius: 50px;
              cursor: pointer;
              transition: all 0.25s ease;
              display: inline-flex;
              align-items: center;
              gap: 8px;
              text-decoration: none;
              box-shadow: 0 4px 15px rgba(236, 72, 153, 0.3);
          }

          .btn:hover {
              transform: translateY(-2px);
              box-shadow: 0 6px 20px rgba(236, 72, 153, 0.4);
          }

          .loading {
              display: none;
              padding: 20px;
          }

          .spinner {
              width: 36px;
              height: 36px;
              border: 3px solid #fce7f3;
              border-top: 3px solid #ec4899;
              border-radius: 50%;
              animation: spin 0.8s linear infinite;
              margin: 0 auto 12px;
          }

          @keyframes spin {
              0% { transform: rotate(0deg); }
              100% { transform: rotate(360deg); }
          }

          .loading p {
              color: #6b7280;
              font-size: 14px;
          }

          /* Sukces - kompaktowy layout */
          .message {
              margin-top: 20px;
              display: none;
          }

          .message.error {
              background: #fef2f2;
              color: #dc2626;
              padding: 16px;
              border-radius: 12px;
              border: 1px solid #fecaca;
          }

          .success-content {
              display: flex;
              align-items: center;
              gap: 20px;
              background: linear-gradient(135deg, #fdf4ff 0%, #fdf2f8 100%);
              padding: 20px 25px;
              border-radius: 16px;
              border: 1px solid #f5d0fe;
          }

          .success-left {
              flex: 1;
              text-align: left;
          }

          .success-label {
              font-size: 12px;
              color: #9ca3af;
              text-transform: uppercase;
              letter-spacing: 0.5px;
              margin-bottom: 6px;
          }

          .code-display {
              font-size: 24px;
              font-weight: 700;
              color: #a855f7;
              letter-spacing: 2px;
              cursor: pointer;
              transition: color 0.2s;
          }

          .code-display:hover {
              color: #9333ea;
          }

          .code-hint {
              font-size: 11px;
              color: #9ca3af;
              margin-top: 4px;
          }

          .success-right {
              flex-shrink: 0;
          }

          .btn-link {
              background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
              color: white;
              border: none;
              padding: 12px 24px;
              font-size: 14px;
              font-weight: 600;
              border-radius: 50px;
              cursor: pointer;
              text-decoration: none;
              display: inline-flex;
              align-items: center;
              gap: 6px;
              transition: all 0.25s ease;
              box-shadow: 0 4px 15px rgba(168, 85, 247, 0.3);
              white-space: nowrap;
          }

          .btn-link:hover {
              transform: translateY(-2px);
              box-shadow: 0 6px 20px rgba(168, 85, 247, 0.4);
          }

          /* Info box - kompaktowy */
          .info-box {
              display: flex;
              justify-content: center;
              gap: 30px;
              margin-top: 25px;
              padding-top: 20px;
              border-top: 1px solid #f3f4f6;
          }

          .info-item {
              display: flex;
              align-items: center;
              gap: 8px;
              color: #6b7280;
              font-size: 13px;
          }

          .info-icon {
              width: 18px;
              height: 18px;
              color: #d946ef;
          }

          .footer {
              margin-top: 20px;
              color: #9ca3af;
              font-size: 12px;
          }

          /* Toast */
          .copied-toast {
              position: fixed;
              bottom: 20px;
              left: 50%;
              transform: translateX(-50%) translateY(80px);
              background: #1f2937;
              color: white;
              padding: 12px 20px;
              border-radius: 10px;
              font-size: 13px;
              font-weight: 500;
              box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
              z-index: 1000;
              opacity: 0;
              transition: all 0.3s ease;
              display: flex;
              align-items: center;
              gap: 8px;
          }

          .copied-toast.show {
              opacity: 1;
              transform: translateX(-50%) translateY(0);
          }

          /* Responsive */
          @media (max-width: 600px) {
              .container {
                  padding: 25px 20px;
              }

              .success-content {
                  flex-direction: column;
                  text-align: center;
                  gap: 15px;
                  padding: 20px;
              }

              .success-left {
                  text-align: center;
              }

              .info-box {
                  flex-direction: column;
                  gap: 12px;
                  align-items: center;
              }

              .code-display {
                  font-size: 20px;
              }
          }
      </style>
  </head>
  <body>
      <div class="container">
          <!-- Ikona kwiat z sercem -->
          <div class="icon-wrapper">
              <svg class="flower-icon" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <!-- Platki kwiatu -->
                  <ellipse cx="50" cy="25" rx="18" ry="22" fill="url(#petal1)" opacity="0.9"/>
                  <ellipse cx="75" cy="40" rx="18" ry="22" fill="url(#petal2)" opacity="0.85" transform="rotate(60 75 40)"/>
                  <ellipse cx="70" cy="68" rx="18" ry="22" fill="url(#petal3)" opacity="0.8" transform="rotate(120 70 68)"/>
                  <ellipse cx="30" cy="68" rx="18" ry="22" fill="url(#petal4)" opacity="0.8" transform="rotate(-120 30 68)"/>
                  <ellipse cx="25" cy="40" rx="18" ry="22" fill="url(#petal5)" opacity="0.85" transform="rotate(-60 25 40)"/>

                  <!-- Srodek - serce -->
                  <path d="M50 38 C50 38, 42 30, 35 33 C28 36, 28 46, 35 52 L50 65 L65 52 C72 46, 72 36, 65 33 C58 30, 50 38, 50 38Z"
                        fill="url(#heart)" />

                  <!-- Gradienty -->
                  <defs>
                      <linearGradient id="petal1" x1="0%" y1="0%" x2="100%" y2="100%">
                          <stop offset="0%" stop-color="#f9a8d4"/>
                          <stop offset="100%" stop-color="#f472b6"/>
                      </linearGradient>
                      <linearGradient id="petal2" x1="0%" y1="0%" x2="100%" y2="100%">
                          <stop offset="0%" stop-color="#f0abfc"/>
                          <stop offset="100%" stop-color="#e879f9"/>
                      </linearGradient>
                      <linearGradient id="petal3" x1="0%" y1="0%" x2="100%" y2="100%">
                          <stop offset="0%" stop-color="#c4b5fd"/>
                          <stop offset="100%" stop-color="#a78bfa"/>
                      </linearGradient>
                      <linearGradient id="petal4" x1="0%" y1="0%" x2="100%" y2="100%">
                          <stop offset="0%" stop-color="#c4b5fd"/>
                          <stop offset="100%" stop-color="#a78bfa"/>
                      </linearGradient>
                      <linearGradient id="petal5" x1="0%" y1="0%" x2="100%" y2="100%">
                          <stop offset="0%" stop-color="#f0abfc"/>
                          <stop offset="100%" stop-color="#e879f9"/>
                      </linearGradient>
                      <linearGradient id="heart" x1="0%" y1="0%" x2="100%" y2="100%">
                          <stop offset="0%" stop-color="#ec4899"/>
                          <stop offset="100%" stop-color="#db2777"/>
                      </linearGradient>
                  </defs>
              </svg>
          </div>

          <h1>Ankieta badawcza</h1>
          <p class="description">
              Kliknij przycisk poniżej, aby otrzymać kod dostępu do ankiety.
          </p>

          <button class="btn" id="getAccessBtn" onclick="getAccess()">
              <span>Pobierz dostęp do ankiety</span>
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M5 12h14M12 5l7 7-7 7"/>
              </svg>
          </button>

          <div class="loading" id="loading">
              <div class="spinner"></div>
              <p>Generowanie dostępu...</p>
          </div>

          <div class="message" id="message"></div>

          <div class="info-box">
              <div class="info-item">
                  <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"/>
                      <path d="M12 6v6l4 2"/>
                  </svg>
                  <span>3-5 minut</span>
              </div>
              <div class="info-item">
                  <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                  </svg>
                  <span>Anonimowa</span>
              </div>
              <div class="info-item">
                  <svg class="info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                      <circle cx="12" cy="7" r="4"/>
                  </svg>
                  <span>Jednorazowa</span>
              </div>
          </div>

          <p class="footer">
              W razie problemów skontaktuj się z organizatorem badania.
          </p>
      </div>

      <div class="copied-toast" id="toast">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
              <polyline points="20 6 9 17 4 12"></polyline>
          </svg>
          Kod skopiowany!
      </div>

      <script>
          const FIREBASE_URL = 'https://ankiety-kody-default-rtdb.europe-west1.firebasedatabase.app/config.json';

          let currentCode = '';
          let formUrl = '';

          async function getAccess() {
              const btn = document.getElementById('getAccessBtn');
              const loading = document.getElementById('loading');
              const message = document.getElementById('message');

              btn.style.display = 'none';
              loading.style.display = 'block';
              message.style.display = 'none';

              try {
                  const response = await fetch(FIREBASE_URL);
                  const data = await response.json();

                  currentCode = data.currentCode;
                  formUrl = data.formUrl;

                  loading.style.display = 'none';

                  message.className = 'message success';
                  message.innerHTML = `
                      <div class="success-content">
                          <div class="success-left">
                              <div class="success-label">Twój kod dostępu</div>
                              <div class="code-display" onclick="copyCode()" title="Kliknij aby skopiować">${currentCode}</div>
                              <div class="code-hint">Kliknij kod aby skopiować • Wybierz go w ankiecie</div>
                          </div>
                          <div class="success-right">
                              <a href="${formUrl}" target="_blank" class="btn-link">
                                  Przejdź do ankiety
                                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                                      <path d="M5 12h14M12 5l7 7-7 7"/>
                                  </svg>
                              </a>
                          </div>
                      </div>
                  `;
                  message.style.display = 'block';

              } catch (error) {
                  loading.style.display = 'none';
                  btn.style.display = 'inline-flex';

                  message.className = 'message error';
                  message.innerHTML = `<strong>Wystąpił błąd.</strong> Spróbuj odświeżyć stronę.`;
                  message.style.display = 'block';
              }
          }

          function copyCode() {
              navigator.clipboard.writeText(currentCode).then(() => {
                  const toast = document.getElementById('toast');
                  toast.classList.add('show');
                  setTimeout(() => {
                      toast.classList.remove('show');
                  }, 2500);
              });
          }
      </script>
  </body>
  </html>
